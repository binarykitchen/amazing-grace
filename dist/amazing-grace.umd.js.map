{"version":3,"file":"amazing-grace.umd.js","sources":["../index.js"],"sourcesContent":["const TERM_SIGNALS = [\n  'SIGTERM',\n  'SIGINT',\n  'SIGUSR2' // SIGUSR2 is for nodemon\n]\n\nmodule.exports = function (server, options = {}) {\n  var closing = false\n\n  options.timeout = options.timeout || 100\n  options.log = options.log || function () {}\n\n  function attemptGracefulShutdown (server, signal) {\n    function forcefulShutdown () {\n      options.log('Could not close connections in %sms, forcefully shutting down', options.timeout)\n      process.kill(process.pid, signal)\n    }\n\n    const graceTimer = setTimeout(forcefulShutdown, options.timeout)\n\n    closing = true\n\n    options.log(\n      'Received %s at %s, shutting down gracefully in %sms',\n      signal,\n      new Date().toString('T'),\n      options.timeout\n    )\n\n    function exitWithSuccess () {\n      clearTimeout(graceTimer)\n\n      options.log('Closed out remaining connections')\n\n      process.kill(process.pid, signal)\n    }\n\n    server.close(exitWithSuccess)\n  }\n\n  // Bind listeners to process for specified signal types\n  server.on('listening', function () {\n    TERM_SIGNALS.forEach(function (signal) {\n      process.once(signal, function () {\n        attemptGracefulShutdown(server, signal)\n      })\n    })\n  })\n\n  // Return middleware\n  return function (req, res, next) {\n    if (closing) {\n      // Just kill keep-alive. Better than manually sending 502 or 503, because\n      // there is already code for that, see http://www.senchalabs.org/connect/timeout.html\n      req.connection.setTimeout(1)\n    }\n\n    next()\n  }\n}\n"],"names":["const","TERM_SIGNALS","module","exports","server","options","closing","timeout","log","on","forEach","signal","process","once","graceTimer","setTimeout","kill","pid","Date","toString","close","clearTimeout","attemptGracefulShutdown","req","res","next","connection"],"mappings":"0IAAAA,IAAMC,EAAe,CACnB,UACA,SACA,WAGFC,OAAOC,QAAU,SAAUC,EAAQC,kBAAU,QACvCC,GAAU,SAEdD,EAAQE,QAAUF,EAAQE,SAAW,IACrCF,EAAQG,IAAMH,EAAQG,KAAO,aA+B7BJ,EAAOK,GAAG,YAAa,WACrBR,EAAaS,QAAQ,SAAUC,GAC7BC,QAAQC,KAAKF,EAAQ,qBA/BSP,EAAQO,OAMlCG,EAAaC,sBAJjBV,EAAQG,IAAI,gEAAiEH,EAAQE,SACrFK,QAAQI,KAAKJ,QAAQK,IAAKN,IAGoBN,EAAQE,SAExDD,GAAU,EAEVD,EAAQG,IACN,sDACAG,GACA,IAAIO,MAAOC,SAAS,KACpBd,EAAQE,SAWVH,EAAOgB,iBAPLC,aAAaP,GAEbT,EAAQG,IAAI,oCAEZI,QAAQI,KAAKJ,QAAQK,IAAKN,KAUxBW,CAAwBlB,EAAQO,SAM/B,SAAUY,EAAKC,EAAKC,GACrBnB,GAGFiB,EAAIG,WAAWX,WAAW,GAG5BU"}